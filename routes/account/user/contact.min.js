'use strict';const express=require("express"),app=express(),router=express.Router(),faker=require("faker"),Contact=require("../../../models/Contact");router.all("/*",(a,c,b)=>{a.app.locals.layout="user";b()});router.get("/",(a,c)=>{Contact.find({user:a.user.id}).populate("user").then(b=>{c.render("accounts/user/contact",{contacts:b})}).catch(b=>console.log(b))});router.get("/create",(a,c)=>{c.render("accounts/user/contact/create")});
router.get("/edit/:id",(a,c)=>{Contact.findOne({_id:a.params.id}).then(b=>{c.render("accounts/user/contact/edit",{contact:b})}).catch(b=>console.log(b))});router.post("/create",(a,c)=>{const b=new Contact;b.user=a.user.id;b.subject=a.body.subject;b.message=a.body.message;b.save().then(d=>{a.flash("success_msg","Contact has been created successfully :)");c.redirect("/")}).catch(d=>console.log(d))});
router.post("/dummy",(a,c)=>{for(let b=0;b<a.body.number;b++){const d=new Contact;d.user=a.user.id;d.subject=faker.random.word();d.message=faker.lorem.sentence();d.save().then(e=>{a.flash("success_msg",`${a.body.number} dummy contacts has been created successfully :)`);c.redirect(`/user/contact/${a.user.id}`)}).catch(e=>console.log(e))}});
router.post("/update/:id",(a,c)=>{Contact.findOne({_id:a.params.id}).then(b=>{b.subject=a.body.subject;b.message=a.body.message;b.save().then(d=>{a.flash("success_msg","Contact has been updated successfully :)");c.redirect(`/user/contact/${a.user.id}`)}).catch(d=>console.log(d))}).catch(b=>console.log(b))});
router.get("/delete/:id",(a,c)=>{Contact.findOne({_id:a.params.id}).then(b=>{b.delete().then(d=>{a.flash("success_msg",`${b.subject} has been deleted successfully :)`);c.redirect(`/user/contact/${a.user.id}`)}).catch(d=>console.log(d))}).catch(b=>console.log(b))});
router.post("/multiaction",(a,c)=>{console.log(a.body.checkboxes);Contact.find({_id:a.body.checkboxes}).then(b=>{b.forEach(d=>{d.delete().then(e=>{a.flash("success_msg",`${d.subject} has been deleted successfully :)`);c.redirect(`/user/contact/${a.user.id}`)}).catch(e=>console.log(e))})}).catch(b=>console.log(b))});module.exports=router;