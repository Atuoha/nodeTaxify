'use strict';const express=require("express"),app=express(),router=express.Router(),faker=require("faker"),Contact=require("../../../models/Contact");router.all("/*",(b,c,a)=>{b.app.locals.layout="admin";a()});router.get("/",(b,c)=>{Contact.find().populate("user").then(a=>{c.render("accounts/admin/contact",{contacts:a})}).catch(a=>console.log(a))});
router.get("/loggedUser/:id",(b,c)=>{Contact.find({_id:b.params.id}).populate("user").then(a=>{c.render("accounts/admin/contact/loggedInContacts",{contacts:a})}).catch(a=>console.log(a))});router.get("/create",(b,c)=>{c.render("accounts/admin/contact/create")});router.get("/dummy",(b,c)=>{c.render("accounts/admin/contact/dummy")});router.get("/edit/:id",(b,c)=>{Contact.findOne({_id:b.params.id}).then(a=>{c.render("accounts/admin/contact/edit",{contact:a})}).catch(a=>console.log(a))});
router.post("/create",(b,c)=>{const a=new Contact;a.user=b.user.id;a.subject=b.body.subject;a.message=b.body.message;a.save().then(d=>{b.flash("success_msg","Contact has been created successfully :)");c.redirect("/admin/contacts")}).catch(d=>console.log(d))});
router.post("/dummy",(b,c)=>{for(let a=0;a<b.body.number;a++){const d=new Contact;d.user=b.user.id;d.subject=faker.random.word();d.message=faker.lorem.sentence();d.save().then(e=>{b.flash("success_msg",`${b.body.number} dummy contacts has been created successfully :)`);c.redirect("/admin/contact")}).catch(e=>console.log(e))}});
router.post("/update/:id",(b,c)=>{Contact.findOne({_id:b.params.id}).then(a=>{a.subject=b.body.subject;a.message=b.body.message;a.save().then(d=>{b.flash("success_msg","Contact has been updated successfully :)");c.redirect("/admin/contact")}).catch(d=>console.log(d))}).catch(a=>console.log(a))});
router.get("/delete/:id",(b,c)=>{Contact.findOne({_id:b.params.id}).then(a=>{a.delete().then(d=>{b.flash("success_msg",`${a.subject} has been deleted successfully :)`);c.redirect("/admin/contact")}).catch(d=>console.log(d))}).catch(a=>console.log(a))});
router.post("/multiaction",(b,c)=>{console.log(b.body.checkboxes);Contact.find({_id:b.body.checkboxes}).then(a=>{a.forEach(d=>{d.delete().then(e=>{b.flash("success_msg",`${d.subject} has been deleted successfully :)`);c.redirect("/admin/contact")}).catch(e=>console.log(e))})}).catch(a=>console.log(a))});module.exports=router;