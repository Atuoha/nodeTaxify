'use strict';const express=require("express"),app=express(),User=require("../../models/User"),bcrypt=require("bcryptjs"),router=express.Router();router.all("/*",(a,b,c)=>{a.app.locals.layout="logs";c()});router.get("/sign",(a,b)=>{b.render("home/logs")});router.post("/login",(a,b)=>{b.send("receiving response....")});
router.post("/register",(a,b)=>{User.findOne({email:a.body.email}).then(c=>{if(c)a.flash("error_msg","User exists with email ):"),b.redirect("back");else{const d=new User;d.email=a.body.email;d.phone=a.body.phone;d.password=a.body.password;bcrypt.genSalt(10,(k,g)=>{bcrypt.hash(a.body.password,g,(e,h)=>{e&&console.log(e);d.password=h;d.save().then(f=>{a.flash("success_msg","Account created. Sign in buddy :) ");b.redirect("back")}).catch(f=>console.log(f))})})}}).catch(c=>console.log(c))});
module.exports=router;