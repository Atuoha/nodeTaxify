'use strict';const express=require("express"),app=express(),path=require("path"),handlebars=require("express-handlebars"),Handlebars=require("handlebars"),port=process.env.PORT||5555,mongoose=require("mongoose"),bodyParser=require("body-parser"),{allowInsecurePrototypeAccess}=require("@handlebars/allow-prototype-access"),methodOverride=require("method-override"),upload=require("express-fileupload"),session=require("express-session"),flash=require("connect-flash"),passport=require("passport"),{mongoDburl}=
require("./config/database");mongoose.set("useFindAndModify",!1);mongoose.Promise=global.Promise;mongoose.connect(mongoDburl,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(a=>console.log("Connected")).catch(a=>console.log(a));app.use(express.static(path.join(__dirname,"public")));const {select,generate_date,ifeq,paginate}=require("./helpers/handlebars-helpers");
app.engine("handlebars",handlebars({defaultLayout:"home",helpers:{select,generate_date,ifeq,paginate},partialsDir:path.join(__dirname,"views/layouts/partials"),handlebars:allowInsecurePrototypeAccess(Handlebars)}));app.use(upload());app.set("view engine","handlebars");app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!0}));app.use(session({secret:"tonyAtuoha",resave:!0,saveUninitialized:!0}));app.use(flash());app.use(passport.initialize());app.use(passport.session());
app.use((a,b,c)=>{b.locals.success_msg=a.flash("success_msg");b.locals.error_msg=a.flash("error_msg");b.locals.error=a.flash("error");b.locals.loggedUser=a.user||null;c()});app.use(methodOverride("_method"));const home=require("./routes/home/home");app.use("/",home);const logs=require("./routes/home/logs");app.use("/logs",logs);const admin=require("./routes/account/admin/admin");app.use("/admin",admin);const admin_users=require("./routes/account/admin/user");app.use("/admin/users",admin_users);
const user=require("./routes/account/user/user");app.use("/user",user);app.listen(port,()=>{console.log(`listening to port:${port}`)});