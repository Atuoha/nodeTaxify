'use strict';"production"!==process.env.NODE_ENV&&require("dotenv").config();
const stripeSecretKey=process.env.STRIPE_SECRET_KEY,StripePubKey=process.env.STRIPE_PUBLISHABLE_KEY,express=require("express"),app=express(),path=require("path"),handlebars=require("express-handlebars"),Handlebars=require("handlebars"),port=process.env.PORT||5555,mongoose=require("mongoose"),bodyParser=require("body-parser"),{allowInsecurePrototypeAccess}=require("@handlebars/allow-prototype-access"),methodOverride=require("method-override"),upload=require("express-fileupload"),session=require("express-session"),
flash=require("connect-flash"),passport=require("passport"),{mongoDburl}=require("./config/database");mongoose.set("useFindAndModify",!1);mongoose.Promise=global.Promise;mongoose.connect(mongoDburl,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(a=>console.log("Connected")).catch(a=>console.log(a));app.use(express.static(path.join(__dirname,"public")));const {select,generate_date,ifeq,paginate}=require("./helpers/handlebars-helpers");
app.engine("handlebars",handlebars({defaultLayout:"home",helpers:{select,generate_date,ifeq,paginate},partialsDir:path.join(__dirname,"views/layouts/partials"),handlebars:allowInsecurePrototypeAccess(Handlebars)}));app.use(upload());app.set("view engine","handlebars");app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!0}));app.use(session({secret:"tonyAtuoha",resave:!0,saveUninitialized:!0}));app.use(flash());app.use(passport.initialize());app.use(passport.session());
app.use((a,b,c)=>{b.locals.success_msg=a.flash("success_msg");b.locals.error_msg=a.flash("error_msg");b.locals.error=a.flash("error");b.locals.loggedUser=a.user||null;c()});app.use(methodOverride("_method"));const home=require("./routes/home/index");app.use("/",home);const logs=require("./routes/home/logs");app.use("/logs",logs);const admin=require("./routes/account/admin/index");app.use("/admin",admin);const admin_users=require("./routes/account/admin/user");app.use("/admin/users",admin_users);
const admin_category=require("./routes/account/admin/category");app.use("/admin/categories",admin_category);const admin_posts=require("./routes/account/admin/post");app.use("/admin/posts",admin_posts);const admin_destination=require("./routes/account/admin/destination");app.use("/admin/destinations",admin_destination);const admin_media=require("./routes/account/admin/media");app.use("/admin/media",admin_media);const admin_contact=require("./routes/account/admin/contact");
app.use("/admin/contact",admin_contact);const admin_booking=require("./routes/account/admin/booking");app.use("/admin/booking",admin_booking);const admin_testimonies=require("./routes/account/admin/testimony");app.use("/admin/testimonies",admin_testimonies);const user=require("./routes/account/user/index");app.use("/user",user);const user_contact=require("./routes/account/user/contact");app.use("/user/contact",user_contact);const user_booking=require("./routes/account/user/booking");
app.use("/user/booking",user_booking);const user_testimonies=require("./routes/account/user/testimony");app.use("/user/testimonies",user_testimonies);const user_profile=require("./routes/account/user/profile");app.use("/user/profile",user_profile);app.listen(port,()=>{console.log(`listening to port:${port}`)});